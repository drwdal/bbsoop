var server_time;var env_base_uri;var session_ID;var topic_title_characters_maximum;jQuery(document).ready(function(){env_base_uri=jQuery('#env_base_uri').val();session_ID=jQuery('#session_ID').val();server_time=jQuery('#server_time').val();jQuery('span.time').each(time_ago);jQuery('span.at-label').each(function(){jQuery(this).detach();});if(location.hash!=''){if(location.hash=='#topic'){jQuery('#topic').addClass('reply-highlight');}else if(location.hash.substring(1,6)=='reply'){jQuery(location.hash).addClass('reply-highlight');}}
give_forms_focus();format_you_replies();if(document.getElementById('seconds_left_to_edit')){edit_countdown();}
jQuery('input.has_calendar').each(function(){jQuery(this).datepicker({dateFormat:'yy-mm-dd'});});if(document.getElementById('topic_title_characters_maximum')){topic_title_characters_maximum=jQuery('#topic_title_characters_maximum').val();jQuery('#record_title').keypress(function(){my_title=jQuery(this).val();jQuery('#title-character-count').html(topic_title_characters_maximum-my_title.length+' characters remaining');});}});function time_ago(index,element){my_seconds=jQuery(element).attr('title');jQuery(element).attr('title',jQuery(element).html());my_time_diff=server_time-my_seconds;my_time_string='';if(my_time_diff>=31536000){my_time_int=Math.floor(my_time_diff/31536000);my_time_string=my_time_int+' year';}else if(my_time_diff>=2592000){my_time_int=Math.floor(my_time_diff/2592000);my_time_string=my_time_int+' month';}else if(my_time_diff>=604800){my_time_int=Math.floor(my_time_diff/604800);my_time_string=my_time_int+' week';}else if(my_time_diff>=86400){my_time_int=Math.floor(my_time_diff/86400);my_time_string=my_time_int+' day';}else if(my_time_diff>=3600){my_time_int=Math.floor(my_time_diff/3600);my_time_string=my_time_int+' hour';}else if(my_time_diff>=60){my_time_int=Math.floor(my_time_diff/60);my_time_string=my_time_int+' minute';}else{my_time_int=my_time_diff;my_time_string=my_time_int+' second';}
if(my_time_int!=1){my_time_string+='s';}
my_time_string+=' ago';jQuery(element).html(my_time_string);}
function give_forms_focus(){if(element=document.getElementById('record_title')){element.focus();return true;}
if(element=document.getElementById('record_body')){element.focus();return true;}
if(element=document.getElementById('username')){element.focus();return true;}}
function play_video(provider,media_ID,element,record_class,record_ID){my_ID=record_class+'-'+record_ID+'-media-'+media_ID;if(jQuery(element).html()=='play'){jQuery(element).html('close');}else{jQuery(element).html('play');jQuery('#'+my_ID).slideUp();return false;}
video_player_html='';if(provider=='youtube'){video_player_html='<div id="'+my_ID+'" style="display: none;" class="video wrapper c"><object width="500" height="405"><param name="movie" value="http://www.youtube-nocookie.com/v/'+media_ID+'&hl=en_US&fs=1&border=1&autoplay=1"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="http://www.youtube-nocookie.com/v/'+media_ID+'&hl=en_US&fs=1&border=1&autoplay=1" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="500" height="405"></embed></object><a href="http://www.youtube.com/watch?v='+media_ID+'" class="youtube_alternate"><img src="http://img.youtube.com/vi/'+media_ID+'/0.jpg" width="480" height="360" alt="Video" /></a></div>';}else if(provider=='vimeo'){video_player_html='<div id="'+my_ID+'" style="display: none;" class="video wrapper c"><object width="512" height="294"><param name="allowfullscreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="movie" value="http://vimeo.com/moogaloop.swf?clip_id='+media_ID+'&server=vimeo.com&show_title=1&show_byline=1&show_portrait=1&fullscreen=1&autoplay=1" /><embed src="http://vimeo.com/moogaloop.swf?clip_id='+media_ID+'&server=vimeo.com&show_title=1&show_byline=1&show_portrait=0&fullscreen=1&autoplay=1" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="512" height="294"></embed></object></div>';}
jQuery(element).parent().after(video_player_html+"\n");jQuery('#'+my_ID).slideDown();}
function handle_at_reply(element){record_ID=jQuery(element).html().replace(/[^0-9]/g,'');jQuery('.reply-highlight').each(function(){jQuery(this).removeClass('reply-highlight');});if(record_ID=='OP'){jQuery('#topic').addClass('reply-highlight');}else{jQuery('#reply-'+record_ID).addClass('reply-highlight');}}
function format_you_replies(){jQuery('div.you').each(function(){my_ID=jQuery(this).attr('id').replace('reply-','');jQuery('a[title='+my_ID+']').each(function(){jQuery(this).after(' <span class="you">(you)</span>');});});}
function favorite_reply(reply_ID){previous_value=jQuery('#favorites-reply-'+reply_ID).html();jQuery.ajax({url:env_base_uri+'topics/favorite_reply',data:{reply_ID:reply_ID,session_ID:session_ID},dataType:'json',type:'POST',beforeSend:function(){jQuery('#favorites-reply-'+reply_ID+'-label').html(' sending…');},success:function(data,textStatus,XMLHttpRequest){if(data.result=='1'){if(data.reply_favorites==0){jQuery('#favorites-reply-'+reply_ID+'-label').html('');}else if(data.reply_favorites==1){jQuery('#favorites-reply-'+reply_ID+'-label').html(' 1 favorite ');}else{jQuery('#favorites-reply-'+reply_ID+'-label').html(' '+data.reply_favorites+' favorites ');}
if(data.action=='added'){jQuery('#favorites-reply-'+reply_ID).html(' - ');}else{jQuery('#favorites-reply-'+reply_ID).html(' + ');}}else{jQuery('#favorites-reply-'+reply_ID).html(previous_value);alert('Error: cannot favorite this reply.');}},error:action_error,complete:function(){}});}
function favorite_topic(topic_ID){previous_value=jQuery('#favorites-topic-'+topic_ID).html();jQuery.ajax({url:env_base_uri+'topics/favorite_topic',data:{topic_ID:topic_ID,session_ID:session_ID},dataType:'json',type:'POST',beforeSend:function(){jQuery('#favorites-topic-'+topic_ID+'-label').html(' sending…');},success:function(data,textStatus,XMLHttpRequest){if(data.result=='1'){if(data.topic_favorites==0){jQuery('#favorites-topic-'+topic_ID+'-label').html('');}else if(data.topic_favorites==1){jQuery('#favorites-topic-'+topic_ID+'-label').html(' 1 favorite ');}else{jQuery('#favorites-topic-'+topic_ID+'-label').html(' '+data.topic_favorites+' favorites ');}
if(data.action=='added'){jQuery('#favorites-topic-'+topic_ID).html(' - ');}else{jQuery('#favorites-topic-'+topic_ID).html(' + ');}}else{jQuery('#favorites-reply-'+topic_ID+'-label').html(previous_value);alert('Error: cannot favorite this reply.');}},error:action_error,complete:function(){}});}
function report_reply(reply_ID){if(jQuery('#report-reply-'+reply_ID).html()==' reported '){alert('Error: you have already reported this reply.');return false;}
jQuery.ajax({url:env_base_uri+'topics/report_reply',data:{reply_ID:reply_ID,reason:'rule violation',session_ID:session_ID},dataType:'json',type:'POST',beforeSend:function(){jQuery('#report-reply-'+reply_ID).html(' sending…');},success:function(data,textStatus,XMLHttpRequest){if(data.result=='1'){if(data.action!='added'){alert('You have already reported this reply.');}
jQuery('#report-reply-'+reply_ID).html(' reported ');}else{alert('Error: cannot report this reply.');}},error:action_error,complete:function(){}});}
function report_topic(topic_ID){if(jQuery('#report-topic-'+topic_ID).html()==' reported '){alert('Error: you have already reported this topic.');return false;}
jQuery.ajax({url:env_base_uri+'topics/report_topic',data:{topic_ID:topic_ID,reason:'rule violation',session_ID:session_ID},dataType:'json',type:'POST',beforeSend:function(){jQuery('#report-topic-'+topic_ID).html(' sending…');},success:function(data,textStatus,XMLHttpRequest){if(data.result=='1'){if(data.action!='added'){alert('You have already reported this topic.');}
jQuery('#report-topic-'+topic_ID).html(' reported ');}else{alert('Error: cannot report this topic.');}},error:action_error,complete:function(){}});}
function username_check(){jQuery.ajax({url:env_base_uri+'account/username_check',data:{username:jQuery('#username_new').val()},dataType:'json',type:'POST',beforeSend:function(){jQuery('#username_loading').css('display','inline');},success:function(data,textStatus,XMLHttpRequest){if(data.result=='1'){jQuery('#username_help').html('<strong>username available!</strong>');jQuery('#username_help').addClass('highlight');}else{jQuery('#username_help').html('<strong>username already taken</strong>');}},error:action_error,complete:function(){jQuery('#username_loading').css('display','none');}});}
function edit_countdown(){var d=new Date();var edit_expires=parseInt(jQuery('#seconds_left_to_edit').attr('title'));var time_left=edit_expires-(Math.round(d.getTime()/1000));if(time_left>0){jQuery('#seconds_left_to_edit').html(time_left);var t=setTimeout("edit_countdown()",1000);}else{jQuery('#seconds_left_to_edit').html('0');}}
function action_error(XMLHttpRequest,textStatus,errorThrown){alert(textStatus+' '+errorThrown);}